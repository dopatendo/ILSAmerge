<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Merge ILSA files • ILSAmerge</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Merge ILSA files">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ILSAmerge</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Download.html">Download ILSA files</a></li>
    <li><a class="dropdown-item" href="../articles/Rename.html">Rename ILSAmerge files</a></li>
    <li><a class="dropdown-item" href="../articles/Load.html">Load ILSA files</a></li>
    <li><a class="dropdown-item" href="../articles/IdentifyILSAfiles.html">Identify ILSA files</a></li>
    <li><a class="dropdown-item" href="../articles/Merge.html">Merge ILSA files</a></li>
    <li><a class="dropdown-item" href="../articles/Onestep.html">One-step solution</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dopatendo/ILSAmerge/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Merge ILSA files</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dopatendo/ILSAmerge/blob/main/vignettes/Merge.Rmd" class="external-link"><code>vignettes/Merge.Rmd</code></a></small>
      <div class="d-none name"><code>Merge.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="downloaded-data">Downloaded data<a class="anchor" aria-label="anchor" href="#downloaded-data"></a>
</h2>
<p>As an example, we can use the data of ‘REDS’ 2021 provided by the
package.</p>
<p>In the case of ‘REDS’ 2021, we have 12 files and 3 populations:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ILSAfile.info.html">ILSAfile.info</a></span><span class="op">(</span>inputdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/reds"</span>, package <span class="op">=</span> <span class="st">"ILSAmerge"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##   Population Files  MB</span></span>
<span><span class="co">## 1      BCGV1     4 0.3</span></span>
<span><span class="co">## 2      BSGV1     4 0.4</span></span>
<span><span class="co">## 3      BTGV1     4 0.3</span></span></code></pre></div>
<p>With <code><a href="../reference/ILSAmerge.html">ILSAmerge()</a></code> we can combine all the files into the
number of populations we have.</p>
<p>The default type will be an “rds”, but also we can make “zsav” and
“sav” files:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ILSAmerge.html">ILSAmerge</a></span><span class="op">(</span>inputdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/reds"</span>, package <span class="op">=</span> <span class="st">"ILSAmerge"</span><span class="op">)</span>, </span>
<span>          outputdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>          filetype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rds"</span>, <span class="st">"zsav"</span>, <span class="st">"sav"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adjust-merge-options">Adjust merge options<a class="anchor" aria-label="anchor" href="#adjust-merge-options"></a>
</h2>
<p>Depending on your goals or the capabilities of your computer, you may
consider adjusting some options of <code><a href="../reference/ILSAmerge.html">ILSAmerge()</a></code>:</p>
<ul>
<li>
<code>population</code>: If you need to merge only some of the
populations from the path, you could include them here as a character
vector. It should be in the same format as the output of
<code><a href="../reference/ILSAfile.info.html">ILSAfile.info()</a></code>.</li>
<li>
<code>MBlimit</code>: If set to <code>NULL</code>, the default, all
files will be merged within R. If set a numeric value that will
establish a limit (from the output of <code><a href="../reference/ILSAfile.info.html">ILSAfile.info()</a></code>) of
which files are going to be merged by R, the populations that go over
this limit will not be merged by R, but instead an SPSS syntax will be
produced. Later, you can use this syntax to merge the files.</li>
<li>
<code>MBlistlimit</code>: In <code><a href="../reference/ILSAmerge.html">ILSAmerge()</a></code> files are
merged in two ways: using a list produced by an lapply function, or an
empty matrix filled up by subscripts. The first method is almost always
faster, but it can use a lot of memory. This argument establishes a
limit for merging by list and not by matrix. We recommend not setting
this higher than 200.</li>
<li>
<code>SPSSlimit</code>: If SPSS syntaxes are going to be produced it
is important to take into account the SPSS requirements for handling
files. This could vary by SPSS version, but normally it is a total of 50
files per command.</li>
</ul>
</div>
<div class="section level2">
<h2 id="progress-and-time-for-merging">Progress and time for merging<a class="anchor" aria-label="anchor" href="#progress-and-time-for-merging"></a>
</h2>
<p>When <code><a href="../reference/ILSAmerge.html">ILSAmerge()</a></code> runs, information about the progress of
the merging and the running time will be produced:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ILSAmerge.html">ILSAmerge</a></span><span class="op">(</span>inputdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/reds"</span>, package <span class="op">=</span> <span class="st">"ILSAmerge"</span><span class="op">)</span>, </span>
<span>          outputdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>          filetype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rds"</span>, <span class="st">"zsav"</span>, <span class="st">"sav"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## 12 files detected. Merging into 3 files.</span></span>
<span><span class="co">## Merging BCGV1. Type 1 of 3.</span></span>
<span><span class="co">## Merging dataset 1 of 4.</span></span>
<span><span class="co">## Merging dataset 2 of 4.</span></span>
<span><span class="co">## Merging dataset 3 of 4.</span></span>
<span><span class="co">## Merging dataset 4 of 4.</span></span>
<span><span class="co">## Merging BCGV1 took 0 seconds or 0.01 minutes.</span></span>
<span><span class="co">## Merging BSGV1. Type 2 of 3.</span></span>
<span><span class="co">## Merging dataset 1 of 4.</span></span>
<span><span class="co">## Merging dataset 2 of 4.</span></span>
<span><span class="co">## Merging dataset 3 of 4.</span></span>
<span><span class="co">## Merging dataset 4 of 4.</span></span>
<span><span class="co">## Merging BSGV1 took 0 seconds or 0 minutes.</span></span>
<span><span class="co">## Merging BTGV1. Type 3 of 3.</span></span>
<span><span class="co">## Merging dataset 1 of 4.</span></span>
<span><span class="co">## Merging dataset 2 of 4.</span></span>
<span><span class="co">## Merging dataset 3 of 4.</span></span>
<span><span class="co">## Merging dataset 4 of 4.</span></span>
<span><span class="co">## Merging BTGV1 took 0 seconds or 0 minutes.</span></span>
<span><span class="co">## Merging took 1 seconds or 0.01 minutes.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="merging-between-respondents">Merging between respondents<a class="anchor" aria-label="anchor" href="#merging-between-respondents"></a>
</h2>
<p>After merging countries it is also possible to merge datasets of the
same or different respondents.</p>
<p>Two functions are available to merge respondents:
<code><a href="../reference/combineStudents.html">combineStudents()</a></code>, and <code>addSchools</code>.</p>
<div class="section level3">
<h3 id="combine-students">Combine students<a class="anchor" aria-label="anchor" href="#combine-students"></a>
</h3>
<p><code><a href="../reference/combineStudents.html">combineStudents()</a></code> combines multiple student files, e.g.,
achievement and background questionnaires, using ‘TIMSS’ Advanced
1995:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Path were raw 'SPSS' files are</span></span>
<span><span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/timssadv"</span>, package <span class="op">=</span> <span class="st">"ILSAmerge"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Path were merged files will be saved</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"combineStudents"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"combineStudents"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merging 'TIMSS' Advanced 1995, as .rds file</span></span>
<span><span class="fu"><a href="../reference/ILSAmerge.html">ILSAmerge</a></span><span class="op">(</span>inputdir <span class="op">=</span> <span class="va">input</span>, outputdir <span class="op">=</span> <span class="va">output</span>, filetype <span class="op">=</span> <span class="st">"rds"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rename files</span></span>
<span><span class="fu"><a href="../reference/ILSArename.html">ILSArename</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span>
<span><span class="co">## 3  ILSAmerge() file(s) found.</span></span>
<span><span class="co">## 3  ILSAmerge() file(s) renamed.</span></span>
<span></span>
<span><span class="co"># Check file names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">output</span>,pattern <span class="op">=</span> <span class="st">".rds"</span><span class="op">)</span></span>
<span><span class="co">## [1] "TIMSSADVANCED_Math_1995_school.rds"             </span></span>
<span><span class="co">## [2] "TIMSSADVANCED_Math_1995_student_achievement.rds"</span></span>
<span><span class="co">## [3] "TIMSSADVANCED_Math_1995_student_background.rds"</span></span>
<span></span>
<span><span class="co"># Combine student files</span></span>
<span><span class="fu"><a href="../reference/combineStudents.html">combineStudents</a></span><span class="op">(</span>inputdir <span class="op">=</span> <span class="va">output</span>, outputdir <span class="op">=</span> <span class="va">output</span><span class="op">)</span></span>
<span><span class="co">## 2  ILSAmerge()/ILSArename() student file(s) found. Combining into 1 file(s).</span></span>
<span><span class="co">## Combining student 1 of 1.</span></span>
<span><span class="co">## Combining students took 0 seconds or 0 minutes.</span></span>
<span></span>
<span><span class="co"># Check file names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">output</span>,pattern <span class="op">=</span> <span class="st">".rds"</span><span class="op">)</span></span>
<span><span class="co">## [1] "TIMSSADVANCED_Math_1995_school.rds"             </span></span>
<span><span class="co">## [2] "TIMSSADVANCED_Math_1995_student_achievement.rds"</span></span>
<span><span class="co">## [3] "TIMSSADVANCED_Math_1995_student_background.rds" </span></span>
<span><span class="co">## [4] "TIMSSADVANCED_Math_1995_student.rds"</span></span></code></pre></div>
<p>As we can see, a new file was created combining the achievement and
the student questionnaire.</p>
</div>
<div class="section level3">
<h3 id="combine-schools">Combine schools<a class="anchor" aria-label="anchor" href="#combine-schools"></a>
</h3>
<p><code><a href="../reference/addSchools.html">addSchools()</a></code> adds school data to student and teacher
files, using ‘TIMSS’ Advanced 1995:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check file names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">output</span>,pattern <span class="op">=</span> <span class="st">".rds"</span><span class="op">)</span></span>
<span><span class="co">## [1] "TIMSSADVANCED_Math_1995_school.rds"             </span></span>
<span><span class="co">## [2] "TIMSSADVANCED_Math_1995_student_achievement.rds"</span></span>
<span><span class="co">## [3] "TIMSSADVANCED_Math_1995_student_background.rds" </span></span>
<span><span class="co">## [4] "TIMSSADVANCED_Math_1995_student.rds"</span></span>
<span></span>
<span><span class="co"># Add school data</span></span>
<span><span class="fu"><a href="../reference/addSchools.html">addSchools</a></span><span class="op">(</span>inputdir <span class="op">=</span> <span class="va">output</span>, outputdir <span class="op">=</span> <span class="va">output</span><span class="op">)</span></span>
<span><span class="co">## 2  ILSAmerge()/ILSArename() file(s) found. Adding schools to 1 file(s).</span></span>
<span><span class="co">## Combined students found for MSAM1.</span></span>
<span><span class="co">## Adding schools to MSAM1, file 1 of 1.</span></span>
<span><span class="co">## Adding schools took 0 seconds or 0 minutes.</span></span>
<span></span>
<span><span class="co"># Check file names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">output</span>,pattern <span class="op">=</span> <span class="st">".rds"</span><span class="op">)</span></span>
<span><span class="co">## [1] "TIMSSADVANCED_Math_1995_school.rds"             </span></span>
<span><span class="co">## [2] "TIMSSADVANCED_Math_1995_student_achievement.rds"</span></span>
<span><span class="co">## [3] "TIMSSADVANCED_Math_1995_student_background.rds" </span></span>
<span><span class="co">## [4] "TIMSSADVANCED_Math_1995_student.rds"            </span></span>
<span><span class="co">## [5] "TIMSSADVANCED_Math_1995_student&amp;school.rds"</span></span></code></pre></div>
<p>As we can see, a new file was created combining the information of
students and schools.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Andrés Christiansen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
